<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nau.ch Video Player - 1080p</title>
    <style>
        /* Grunddesign */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body, html { 
            width: 100%; 
            height: 100%; 
            background-color: #000; 
            overflow: hidden; /* Verhindert Scrollbalken */
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* Festgesetzte Größe auf 1920x1080 */
        #player-wrapper {
            position: relative;
            width: 1920px;
            height: 1080px;
            background-color: #000;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        video {
            width: 1920px;
            height: 1080px;
            object-fit: cover; /* 'cover' füllt die 1080p komplett aus, 'contain' lässt ggf. schwarze Ränder */
        }

        /* Status-Meldung nur für den Hintergrund/Fehler */
        #status-msg {
            position: absolute;
            color: #333;
            font-family: sans-serif;
            font-size: 1.2rem;
            z-index: 10;
        }
    </style>
</head>
<body>

<div id="player-wrapper">
    <div id="status-msg">Lade Feed...</div>
    <video id="mainPlayer" autoplay muted playsinline></video>
</div>

<script>
    const TARGET_API = 'https://api.nau.ch/feeds/dooh/test';
    const PROXY_URL = 'https://corsproxy.io/?' + encodeURIComponent(TARGET_API);
    
    const videoElement = document.getElementById('mainPlayer');
    const statusMsg = document.getElementById('status-msg');

    let playlist = [];
    let currentIndex = 0;

    async function initPlayer() {
        try {
            const response = await fetch(PROXY_URL);
            if (!response.ok) throw new Error('API Fehler');
            
            const data = await response.json();

            playlist = data.map(item => {
                const mp4 = item.video.urls.find(url => url.endsWith('.mp4'));
                return { url: mp4 };
            }).filter(item => item.url);

            if (playlist.length > 0) {
                statusMsg.style.display = 'none';
                playVideo(0);
            } else {
                statusMsg.innerText = "Keine Videos gefunden.";
            }
        } catch (err) {
            console.error("Fehler:", err);
            statusMsg.innerText = "Verbindungsfehler.";
        }
    }

    function playVideo(index) {
        if (index >= playlist.length) index = 0;
        currentIndex = index;

        videoElement.src = playlist[currentIndex].url;
        videoElement.play().catch(e => console.warn("Autoplay blockiert"));
    }

    videoElement.onended = () => {
        playVideo(currentIndex + 1);
    };

    videoElement.onerror = () => {
        setTimeout(() => playVideo(currentIndex + 1), 2000);
    };

    initPlayer();
</script>

</body>
</html>